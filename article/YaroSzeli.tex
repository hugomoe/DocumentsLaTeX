% contient la description des différentes méthodes pour traiter les rotations de la décomposition

Pour les deux rotations dans la décomposition, plusieures méthodes sont possibles : la méthode de Yaroslavsky \cite{unser1995convolution} et la méthode de traitement des affinités multi-étapes \cite{szeliski2010high}.

\subsubsection{Méthode de Yaroslavsky}

La méthode de Yaroslavsky consiste à décomposer une rotation en trois \emph{shears}.

Sous forme matricielle une rotation s'écrit de manière générale :
\begin{equation*}
	H=\begin{pmatrix}
	cos \theta&-sin \theta\\sin \theta&cos \theta
	\end{pmatrix}
	\end{equation*}
\begin{prop}
Toutes rotations se décompose en trois \emph{shears} de la manière suivante :
\begin{equation*}
	H=\begin{pmatrix}
	cos \theta&-sin \theta\\sin \theta&cos \theta
	\end{pmatrix}=\begin{pmatrix}
	1&-tan \frac{\theta}{2}\\0&1
	\end{pmatrix}\begin{pmatrix}
	1&0\\sin \theta&1
	\end{pmatrix}\begin{pmatrix}
	1&-tan \frac{\theta}{2}\\0&1
	\end{pmatrix}
	\end{equation*}
\end{prop}

	Pour faire la rotation complète on fait chaque \emph{shear} par Fourier et on recentre l'image à chaque étape.
	En pratique on se ramène toujours à des rotations d'angle dans $[\frac{-\pi}{4},\frac{\pi}{4}]$ (on peut en effet faire des rotations d'angle $\pi$ et $\frac{\pi}{2}$ de manière exacte...)  


\subsubsection{Comparaison entre la méthode de Yaroslavsky et la méthode de traitement des affinités multi-étapes}

%A voir peut être dans les expériences ?
	Dans les deux paragraphes suivants, l'erreur rms corresponds à la norme L2 de la différence entre l'image initiale et l'image ayant subie une rotation, l'erreur L1 est la norme L1 de cette même différence, et l'erreur max est la norme sup de cette différence.\\

	Afin d'observer de réelles différences entre les méthodes de rotations, on peut faire 360 rotations de 1 degré. On obtient les résultats figure  \ref{rotalenabis}.  On remarque que la méthode de traitement des affinités multi-étape avec une interpolation par b-spline d'ordre 9 est la plus proche de l'image initiale (erreur rms : 6.843022,erreur L1 : 4.037093,erreur max : 86.855512,duree : 6114.147000s), cependant elle est beaucoup plus longue que les autres méthode.  La méthode de traitement des affinités multi-étape avec une interpolation par b-spline d'ordre 3 est assez floue ( erreur rms : 14.869476, erreur L1 : 8.520798, erreur max : 158.043518, duree : 1268.177979s). Celle de Yaroslavsky est beaucoup plus rapide, n'est pas floue, mais par contre on peut noter quelques erreurs dans les coins de droite (erreur rms : 14.187158, erreur L1 : 7.779127, erreur max : 211.168716). Enfin  la méthode de traitement des affinités multi-étape avec le  Raised-Cosine-weigted sinc comme filtre d'interpolation est aussi très rapide mais introduit beaucoup d'erreur (erreur rms : 828.852295, erreur L1 : 503.147064, erreur max : 13638.214844, duree : 778.429016s).\\

	En pratique si l'on veut un programme qui tourne en temps très court, seules  la méthode de traitement des affinités multi-étapes avec le Raised-Cosine-weigted sinc comme filtre d'interpolation et la méthode de Yaroslavsky semblent raisonnables. Etant donné que l'on ne fait que deux rotations dans la décomposition des homographies, pour comparer les deux méthodes on réalise seulement 10 rotations de l'image "Lena" de $\frac{\pi}{5}$. Les résultats sont sur la figure \ref{rotalena}. Visuellement les rotations semblent parfaites (mais si on observe bien il y a un peu plus d'effet Gibbs pour la méthode de traitement des affinités multi-étapes (avec le Raised-Cosine-weigted sin comme filtre d'interpolation) que pour Yaroslavsky). Les erreures de la méthode de traitement des affinités multi-étapes (avec le Raised-Cosine-weigted sin comme filtre d'interpolation) sont : erreur rms : 5.979119, erreur L1 : 3.624343, erreur max : 72.128845. Pour Yaroslavsky : erreur rms : 12.817376, erreur L1 : 7.374875, erreur max : 159.840759. \\

En terme de complexité, la méthode de Yaroslavsky est en $O(n log(n))$ (où $n$ est le nombre de pixel de l'image), tandis que la méthode de traitement des affinités multi-étapes est en $O(n)$. Ainsi pour des images de grande taille, il vaut mieux choisir la méthode de traitement des affinités multi-étapes.\\

Pour les expériences qui suivent, la méthode de traitement des affinités multi-étapes avec le  Raised-Cosine-weigted sinc comme filtre d'interpolation à été choisie (pusiqu'elle est toujours dans les méthodes les plus rapides quelque soit la taille de l'image, et parce qu'elle donne des résultats corrects).  

 \begin{figure}[h]
 
   \centering
   \subfigPDP{Lena originale}{lena.png}
   \subfigPDP{Lena après 360 rotations par Szeliski (filtre d'interpolation : Raised-Cosine-weigted sinc))}{raised-cosine_beta0-36_lena.png}
\subfigPDP{Lena après 360 rotations par Szeliski (interpolation par b-spline d'ordre 3)}{b-spline_order3_lena.png}
   \subfigPDP{Lena après 360 rotations par Szeliski (interpolation par b-spline d'ordre 9)}{b-spline_order9_double_lena.png}
   \subfigPDP{Lena après 360 rotations par Yaroslasky}{lena_360_rotations_yaro.png}
   \caption{Effet de 360 rotations}
\label{rotalenabis}
 \end{figure}

 \begin{figure}[h]
 
   \centering
   \subfigPDP{Lena originale}{lena.png}
   \subfigPDP{Lena après dix rotations par Szeliski}{lena_10_rotations_szeli.png}
   \subfigPDP{Lena après dix rotations par Yaroslasky (filtre d'interpolation : Raised-Cosine-weigted sinc)}{lena_10_rotations_yaro.png}
   \caption{Effet de dix rotations}
\label{rotalena}
 \end{figure}